<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
  <title>ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/pretendard/1.3.9/static/pretendard.min.css" rel="stylesheet">
  <style>
    *{-webkit-tap-highlight-color:transparent;box-sizing:border-box;font-family:Pretendard,system-ui,sans-serif}
    body{margin:0;padding:0;background:#f8fafc}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;
const API=window.location.origin+'/api';

// ê¸°ìˆ ì  ì§€í‘œ
const calcRSI=(p,n=14)=>{if(p.length<n+1)return 50;let g=0,l=0;for(let i=1;i<=n;i++){const d=p[i-1]-p[i];d>0?g+=d:l-=d}return l===0?100:Math.round(100-100/(1+g/l))};
const calcMACD=(p)=>{if(p.length<26)return{c:'n'};const ema=(d,n)=>{let e=d.slice(0,n).reduce((a,b)=>a+b)/n;for(let i=n;i<d.length;i++)e=d[i]*(2/(n+1))+e*(1-2/(n+1));return e};return{c:ema(p,12)-ema(p,26)>0?'g':'d'}};
const calcBB=(p,n=20)=>{if(p.length<n)return{pB:50};const s=p.slice(0,n),avg=s.reduce((a,b)=>a+b)/n,std=Math.sqrt(s.reduce((x,v)=>x+(v-avg)**2,0)/n),u=avg+std*2,l=avg-std*2;return{pB:std?Math.round((p[0]-l)/(u-l)*100):50,u,l}};
const getMA=(p)=>{if(p.length<60)return{st:'ë¶€ì¡±'};const m5=p.slice(0,5).reduce((a,b)=>a+b)/5,m20=p.slice(0,20).reduce((a,b)=>a+b)/20,m60=p.slice(0,60).reduce((a,b)=>a+b)/60;return{st:m5>m20&&m20>m60?'ì •ë°°ì—´':m5<m20&&m20<m60?'ì—­ë°°ì—´':'í˜¼ì¡°',m5,m20,m60}};
const calcVol=(v)=>{if(v.length<20)return{s:'ë³´í†µ'};const avg=v.slice(0,20).reduce((a,b)=>a+b)/20;return{s:v[0]/avg>=2?'ê¸‰ì¦':v[0]/avg>=1.5?'ì¦ê°€':'ë³´í†µ'}};
const calcPostSurge=(d)=>{if(d.length<60)return{is:false,sc:0};const p=d.map(x=>x.c),cur=p[0],h6m=Math.max(...p.slice(0,Math.min(120,p.length))),l3m=Math.min(...p.slice(0,60));let sc=0;if((h6m-cur)/h6m*100>30)sc+=30;if((cur-l3m)/l3m*100<10)sc+=25;return{is:sc>=50,sc}};

const calcAI=(s)=>{
  let sc=0,rs=[];
  if(s.rsi<30){sc+=15;rs.push('RSI ê³¼ë§¤ë„')}else if(s.rsi>70){sc-=15;rs.push('RSI ê³¼ë§¤ìˆ˜')}
  if(s.ma?.st==='ì •ë°°ì—´'){sc+=20;rs.push('ì´í‰ì„  ì •ë°°ì—´')}else if(s.ma?.st==='ì—­ë°°ì—´'){sc-=15}
  if(s.macd?.c==='g'){sc+=15;rs.push('MACD ìƒìŠ¹')}
  if(s.bb?.pB<20){sc+=12;rs.push('ë³¼ë¦°ì € í•˜ë‹¨')}
  if(s.vol?.s==='ê¸‰ì¦'){sc+=10;rs.push('ê±°ë˜ëŸ‰ ê¸‰ì¦')}
  if(s.ps?.is){sc+=25;rs.unshift('ğŸ”¥ ê¸‰ë“±í›„ ì €ì ')}
  if(s.inv?.fBuy>0){sc+=10;rs.push('ì™¸êµ­ì¸ ë§¤ìˆ˜')}
  
  let act='ê´€ë§',grade='C';
  if(sc>=40){act='ì ê·¹ ë§¤ìˆ˜';grade='A'}
  else if(sc>=20){act='ë§¤ìˆ˜ ê³ ë ¤';grade='B'}
  else if(sc<=-20){act='ë§¤ë„ ê³ ë ¤';grade='D'}
  
  const pr=s.price||0;
  return{sc,act,grade,tg:Math.round(pr*1.1),sl:Math.round(pr*.95),rs:rs.slice(0,4)};
};

const fmtN=n=>n?.toLocaleString()||'0';
const fmtP=n=>(n>=0?'+':'')+n?.toFixed(2)+'%';

// ì°¨íŠ¸
const PriceChart=({data,period})=>{
  const ref=useRef(),ch=useRef();
  useEffect(()=>{
    if(!ref.current||!data?.length)return;
    ch.current?.destroy();
    const days={w:7,m:30,q:60}[period]||30;
    const d=data.slice(0,days),lb=d.map(x=>x.dt).reverse(),pr=d.map(x=>x.c).reverse();
    ch.current=new window.Chart(ref.current,{type:'line',data:{labels:lb,datasets:[{data:pr,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,.1)',fill:true,tension:.3,pointRadius:0,borderWidth:2}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#94a3b8',maxTicksLimit:5,font:{size:10}},grid:{display:false}},y:{ticks:{color:'#94a3b8',font:{size:10}},grid:{color:'#e2e8f0'}}}}});
    return()=>ch.current?.destroy();
  },[data,period]);
  return<div className="h-40 bg-white rounded-xl p-3"><canvas ref={ref}/></div>;
};

// ì•±
const App=()=>{
  const[key,setKey]=useState(localStorage.getItem('k')||'');
  const[sec,setSec]=useState(localStorage.getItem('s')||'');
  const[save,setSave]=useState(localStorage.getItem('sv')==='1');
  const[logged,setLogged]=useState(false);
  const[tab,setTab]=useState('home');
  const[mode,setMode]=useState('day');
  const[price,setPrice]=useState('all');
  const[load,setLoad]=useState(false);
  const[err,setErr]=useState('');
  const[list,setList]=useState([]);
  const[sel,setSel]=useState(null);
  const[upd,setUpd]=useState('');
  const[prog,setProg]=useState('');
  const[period,setPeriod]=useState('m');
  const[favs,setFavs]=useState(()=>JSON.parse(localStorage.getItem('fav')||'[]'));
  const[charts,setCharts]=useState({});
  const[news,setNews]=useState([]);
  const[briefing,setBriefing]=useState(null);
  const[invData,setInvData]=useState({});

  useEffect(()=>{localStorage.setItem('fav',JSON.stringify(favs))},[favs]);
  useEffect(()=>{if(save&&key&&sec)login()},[]);

  const login=async()=>{
    if(!key||!sec){setErr('KEY/SECRET í•„ìš”');return}
    setLoad(true);setErr('');
    try{
      const r=await fetch(API+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec})});
      if(r.ok){if(save){localStorage.setItem('k',key);localStorage.setItem('s',sec);localStorage.setItem('sv','1')}setLogged(true)}
      else setErr((await r.json()).error||'ë¡œê·¸ì¸ ì‹¤íŒ¨');
    }catch(e){setErr(e.message)}
    setLoad(false);
  };

  const logout=()=>{setLogged(false);['k','s','sv'].forEach(x=>localStorage.removeItem(x));setKey('');setSec('')};

  const loadChart=async(code)=>{
    if(charts[code])return charts[code];
    try{
      const r=await fetch(API+'/daily-chart',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,stockCode:code})});
      const d=await r.json();
      if(d.success&&d.data){
        const f=d.data.map(x=>({dt:x.stck_bsop_date?.slice(4,6)+'/'+x.stck_bsop_date?.slice(6,8),o:+x.stck_oprc,h:+x.stck_hgpr,l:+x.stck_lwpr,c:+x.stck_clpr,v:+x.acml_vol})).filter(x=>x.c>0);
        setCharts(p=>({...p,[code]:f}));return f;
      }
    }catch{}return[];
  };

  const loadInvestor=async(code)=>{
    try{
      const r=await fetch(API+'/investor',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,stockCode:code})});
      const d=await r.json();
      if(d.success&&d.data?.length){
        const t=d.data[0],inv={fBuy:+t.frgn_ntby_qty||0,iBuy:+t.orgn_ntby_qty||0};
        setInvData(p=>({...p,[code]:inv}));return inv;
      }
    }catch{}return{fBuy:0,iBuy:0};
  };

  // ëª¨ì˜ ë‰´ìŠ¤ ìƒì„± (ì‹¤ì œë¡œëŠ” ë‰´ìŠ¤ API ì—°ë™ í•„ìš”)
  const genNews=(stocks)=>{
    const templates=[
      {t:'ğŸ“ˆ ìƒìŠ¹ ëª¨ë©˜í…€',c:'ê¸°ê´€ ë§¤ìˆ˜ì„¸ ìœ ì…ìœ¼ë¡œ ê°•ì„¸'},
      {t:'ğŸ“Š ì‹¤ì  ë°œí‘œ ì˜ˆì •',c:'ë‹¤ìŒì£¼ ë¶„ê¸° ì‹¤ì  ë°œí‘œ ì•ë‘ê³  ì£¼ëª©'},
      {t:'ğŸ”” ì‹ ê·œ ê³„ì•½ ì²´ê²°',c:'ëŒ€ê·œëª¨ ê³µê¸‰ê³„ì•½ìœ¼ë¡œ ì„±ì¥ ê¸°ëŒ€'},
      {t:'ğŸ’¡ ì‹ ì‚¬ì—… ì§„ì¶œ',c:'AI/ë°˜ë„ì²´ ì‚¬ì—… í™•ì¥ ë°œí‘œ'},
      {t:'âš ï¸ ë³€ë™ì„± í™•ëŒ€',c:'ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„± ì£¼ì˜'},
    ];
    return stocks.slice(0,5).map((s,i)=>({
      stock:s.name,
      code:s.code,
      ...templates[i%templates.length],
      time:['1ë¶„ì „','5ë¶„ì „','10ë¶„ì „','30ë¶„ì „','1ì‹œê°„ì „'][i]
    }));
  };

  // AI ë¸Œë¦¬í•‘ ìƒì„±
  const genBriefing=(stocks)=>{
    if(!stocks.length)return null;
    const top3=stocks.filter(s=>s.ai?.sc>=20).slice(0,3);
    const hot=stocks.filter(s=>s.chg>=5).slice(0,2);
    const low=stocks.filter(s=>s.ps?.is).slice(0,2);
    
    const hour=new Date().getHours();
    const greeting=hour<12?'ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! â˜€ï¸':hour<18?'ì¢‹ì€ ì˜¤í›„ì—ìš”! ğŸŒ¤ï¸':'ì¢‹ì€ ì €ë…ì´ì—ìš”! ğŸŒ™';
    
    return{
      greeting,
      summary:`ì˜¤ëŠ˜ ${stocks.length}ê°œ ì¢…ëª©ì„ ë¶„ì„í–ˆì–´ìš”.`,
      top3,
      hot,
      low,
      tip:top3.length?`${top3[0].name}ì´(ê°€) AI ì ìˆ˜ ${top3[0].ai?.sc}ì ìœ¼ë¡œ ê°€ì¥ ìœ ë§í•´ìš”!`:'í˜„ì¬ ê°•ë ¥ ì¶”ì²œ ì¢…ëª©ì´ ì—†ì–´ìš”. ê´€ë§ì„ ê¶Œì¥ë“œë ¤ìš”.'
    };
  };

  const analyze=async(code,name,rawData)=>{
    const ch=rawData||await loadChart(code);
    if(!ch.length)return{error:true};
    const p=ch.map(x=>x.c),v=ch.map(x=>x.v);
    const rsi=calcRSI(p),ma=getMA(p),macd=calcMACD(p),bb=calcBB(p),vol=calcVol(v),ps=calcPostSurge(ch);
    const inv=await loadInvestor(code);
    const result={rsi,ma,macd,bb,vol,ps,inv};
    result.ai=calcAI(result);
    return result;
  };

  const scan=async()=>{
    setLoad(true);setErr('');setProg('ë¶„ì„ ì¤‘...');
    try{
      const results={low:[],mid:[]};
      
      // ë™ì „ì£¼
      setProg('ë™ì „ì£¼ ë¶„ì„ ì¤‘...');
      const[vL,cL]=await Promise.all([
        fetch(API+'/volume-rank',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,priceMin:'10',priceMax:'999'})}).then(r=>r.json()),
        fetch(API+'/change-rank',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,priceMin:'10',priceMax:'999',isUp:true})}).then(r=>r.json())
      ]);
      const mL=new Map();[...(vL.data||[]),...(cL.data||[])].forEach(s=>{const c=s.mksc_shrn_iscd||s.stck_shrn_iscd;c&&!mL.has(c)&&mL.set(c,s)});
      const tL=Array.from(mL.values()).slice(0,12);
      
      for(let i=0;i<tL.length;i++){
        const s=tL[i],code=s.mksc_shrn_iscd||s.stck_shrn_iscd;
        setProg(`ë™ì „ì£¼ ${i+1}/${tL.length}`);
        await new Promise(r=>setTimeout(r,100));
        const ch=await loadChart(code),a=await analyze(code,s.hts_kor_isnm,ch);
        if(!a.error)results.low.push({code,name:s.hts_kor_isnm,price:+s.stck_prpr||0,chg:+s.prdy_ctrt||0,volume:+s.acml_vol||0,type:'ë™ì „ì£¼',...a});
      }

      // ì¤‘ê°€ì£¼
      setProg('ì¤‘ê°€ì£¼ ë¶„ì„ ì¤‘...');
      const[vM,cM]=await Promise.all([
        fetch(API+'/volume-rank',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,priceMin:'1000',priceMax:'9999'})}).then(r=>r.json()),
        fetch(API+'/change-rank',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({appKey:key,appSecret:sec,priceMin:'1000',priceMax:'9999',isUp:true})}).then(r=>r.json())
      ]);
      const mM=new Map();[...(vM.data||[]),...(cM.data||[])].forEach(s=>{const c=s.mksc_shrn_iscd||s.stck_shrn_iscd;c&&!mM.has(c)&&mM.set(c,s)});
      const tM=Array.from(mM.values()).slice(0,12);
      
      for(let i=0;i<tM.length;i++){
        const s=tM[i],code=s.mksc_shrn_iscd||s.stck_shrn_iscd;
        setProg(`ì¤‘ê°€ì£¼ ${i+1}/${tM.length}`);
        await new Promise(r=>setTimeout(r,100));
        const ch=await loadChart(code),a=await analyze(code,s.hts_kor_isnm,ch);
        if(!a.error)results.mid.push({code,name:s.hts_kor_isnm,price:+s.stck_prpr||0,chg:+s.prdy_ctrt||0,volume:+s.acml_vol||0,type:'ì¤‘ê°€ì£¼',...a});
      }

      const sortFn=l=>{
        if(mode==='day')return l.sort((a,b)=>(b.chg*2+b.volume/1e6)-(a.chg*2+a.volume/1e6));
        if(mode==='swing')return l.sort((a,b)=>(b.ai?.sc||0)-(a.ai?.sc||0));
        if(mode==='bottom')return l.filter(x=>x.ps?.sc>=30).sort((a,b)=>(b.ps?.sc||0)-(a.ps?.sc||0));
        return l;
      };

      const sL=sortFn([...results.low]).slice(0,10);
      const sM=sortFn([...results.mid]).slice(0,10);
      const all=price==='low'?sL:price==='mid'?sM:[...sL,...sM];
      
      setList(all);
      setNews(genNews(all));
      setBriefing(genBriefing(all));
      setUpd(new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}));
    }catch(e){setErr(e.message)}
    setLoad(false);setProg('');
  };

  const isFav=c=>favs.some(f=>f.code===c);
  const togFav=(s,e)=>{e?.stopPropagation();setFavs(isFav(s.code)?favs.filter(f=>f.code!==s.code):[...favs,{code:s.code,name:s.name}])};

  // ë“±ê¸‰ ìƒ‰ìƒ
  const gradeColor={A:'bg-green-500',B:'bg-blue-500',C:'bg-gray-400',D:'bg-red-500'};

  // ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
  const Card=({s,i})=>(
    <div onClick={()=>{setSel(sel?.code===s.code?null:s);loadChart(s.code)}} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3">
      <div className="flex justify-between items-start mb-3">
        <div className="flex items-center gap-3">
          <div className={`w-10 h-10 rounded-xl ${gradeColor[s.ai?.grade]||'bg-gray-400'} flex items-center justify-center text-white font-bold text-lg`}>{s.ai?.grade||'?'}</div>
          <div>
            <div className="font-semibold text-gray-900 flex items-center gap-1">
              {s.name}
              {s.ps?.is&&<span className="text-orange-500">ğŸ”¥</span>}
            </div>
            <div className="text-sm text-gray-500">{s.code} Â· {s.type}</div>
          </div>
        </div>
        <button onClick={e=>togFav(s,e)} className="text-xl">{isFav(s.code)?'â­':'â˜†'}</button>
      </div>

      <div className="flex justify-between items-end mb-3">
        <div>
          <div className="text-2xl font-bold text-gray-900">{fmtN(s.price)}ì›</div>
          <div className={`text-sm font-medium ${s.chg>=0?'text-red-500':'text-blue-500'}`}>{fmtP(s.chg)}</div>
        </div>
        <div className="text-right">
          <div className="text-sm text-gray-500">AI ì ìˆ˜</div>
          <div className={`text-xl font-bold ${s.ai?.sc>=20?'text-green-600':s.ai?.sc<0?'text-red-500':'text-gray-600'}`}>{s.ai?.sc||0}ì </div>
        </div>
      </div>

      <div className="flex gap-2 flex-wrap mb-2">
        <span className="px-2 py-1 bg-gray-100 rounded-lg text-xs text-gray-600">RSI {s.rsi}</span>
        <span className={`px-2 py-1 rounded-lg text-xs ${s.ma?.st==='ì •ë°°ì—´'?'bg-green-100 text-green-700':'bg-gray-100 text-gray-600'}`}>{s.ma?.st}</span>
        <span className={`px-2 py-1 rounded-lg text-xs ${s.macd?.c==='g'?'bg-blue-100 text-blue-700':'bg-gray-100 text-gray-600'}`}>MACD {s.macd?.c==='g'?'â†‘':'â†“'}</span>
        <span className={`px-2 py-1 rounded-lg text-xs ${s.vol?.s==='ê¸‰ì¦'?'bg-red-100 text-red-700':'bg-gray-100 text-gray-600'}`}>ê±°ë˜ëŸ‰ {s.vol?.s}</span>
      </div>

      {sel?.code===s.code&&(
        <div className="mt-4 pt-4 border-t border-gray-100">
          <div className="flex gap-2 mb-3">
            {['w','m','q'].map(p=><button key={p} onClick={e=>{e.stopPropagation();setPeriod(p)}} className={`px-3 py-1 rounded-lg text-sm ${period===p?'bg-blue-500 text-white':'bg-gray-100 text-gray-600'}`}>{p==='w'?'1ì£¼':p==='m'?'1ê°œì›”':'3ê°œì›”'}</button>)}
          </div>
          
          {charts[s.code]&&<PriceChart data={charts[s.code]} period={period}/>}
          
          <div className="mt-4 bg-blue-50 rounded-xl p-4">
            <div className="font-semibold text-blue-900 mb-2">ğŸ¤– AI ë¶„ì„</div>
            <div className="text-blue-800 mb-2">{s.ai?.act}</div>
            <div className="text-sm text-blue-600 mb-3">{s.ai?.rs?.join(' Â· ')}</div>
            <div className="flex gap-4 text-sm">
              <div><span className="text-gray-500">ëª©í‘œê°€</span> <span className="font-semibold text-green-600">{fmtN(s.ai?.tg)}ì›</span></div>
              <div><span className="text-gray-500">ì†ì ˆê°€</span> <span className="font-semibold text-red-500">{fmtN(s.ai?.sl)}ì›</span></div>
            </div>
          </div>

          {invData[s.code]&&(
            <div className="mt-3 flex gap-3">
              <div className={`flex-1 p-3 rounded-xl ${invData[s.code].fBuy>0?'bg-red-50':'bg-blue-50'}`}>
                <div className="text-xs text-gray-500">ì™¸êµ­ì¸</div>
                <div className={`font-semibold ${invData[s.code].fBuy>0?'text-red-600':'text-blue-600'}`}>{invData[s.code].fBuy>0?'+':''}{fmtN(invData[s.code].fBuy)}</div>
              </div>
              <div className={`flex-1 p-3 rounded-xl ${invData[s.code].iBuy>0?'bg-red-50':'bg-blue-50'}`}>
                <div className="text-xs text-gray-500">ê¸°ê´€</div>
                <div className={`font-semibold ${invData[s.code].iBuy>0?'text-red-600':'text-blue-600'}`}>{invData[s.code].iBuy>0?'+':''}{fmtN(invData[s.code].iBuy)}</div>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );

  // AI ë¸Œë¦¬í•‘ ì¹´ë“œ
  const BriefingCard=()=>{
    if(!briefing)return null;
    return(
      <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl p-5 text-white mb-4">
        <div className="text-lg font-semibold mb-1">{briefing.greeting}</div>
        <div className="text-blue-100 text-sm mb-4">{briefing.summary}</div>
        
        {briefing.top3?.length>0&&(
          <div className="bg-white/20 rounded-xl p-3 mb-3">
            <div className="text-sm font-medium mb-2">â­ ì˜¤ëŠ˜ì˜ ì¶”ì²œ</div>
            {briefing.top3.map((s,i)=>(
              <div key={s.code} className="flex justify-between items-center py-1">
                <span>{i+1}. {s.name}</span>
                <span className="font-semibold">{s.ai?.sc}ì </span>
              </div>
            ))}
          </div>
        )}
        
        <div className="text-sm bg-white/10 rounded-xl p-3">
          ğŸ’¡ {briefing.tip}
        </div>
      </div>
    );
  };

  // ë‰´ìŠ¤ ì¹´ë“œ
  const NewsCard=()=>{
    if(!news.length)return null;
    return(
      <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-4">
        <div className="font-semibold text-gray-900 mb-3">ğŸ“° ì‹¤ì‹œê°„ ë‰´ìŠ¤</div>
        {news.map((n,i)=>(
          <div key={i} className="flex gap-3 py-3 border-b border-gray-50 last:border-0">
            <div className="flex-1">
              <div className="font-medium text-gray-900">{n.t}</div>
              <div className="text-sm text-gray-500">{n.stock} Â· {n.c}</div>
            </div>
            <div className="text-xs text-gray-400">{n.time}</div>
          </div>
        ))}
      </div>
    );
  };

  // ë¡œê·¸ì¸ í™”ë©´
  if(!logged)return(
    <div className="min-h-screen flex items-center justify-center p-6 bg-gradient-to-b from-blue-50 to-white">
      <div className="w-full max-w-sm">
        <div className="text-center mb-8">
          <div className="text-4xl mb-2">ğŸ“ˆ</div>
          <h1 className="text-2xl font-bold text-gray-900">ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ</h1>
          <p className="text-gray-500 mt-1">AI ê¸°ë°˜ ì¢…ëª© ë¶„ì„</p>
        </div>
        <div className="bg-white rounded-2xl p-6 shadow-lg">
          <input value={key} onChange={e=>setKey(e.target.value)} className="w-full bg-gray-50 rounded-xl px-4 py-3 text-base mb-3 border-0 focus:ring-2 focus:ring-blue-500" placeholder="APP KEY"/>
          <input type="password" value={sec} onChange={e=>setSec(e.target.value)} className="w-full bg-gray-50 rounded-xl px-4 py-3 text-base mb-4 border-0 focus:ring-2 focus:ring-blue-500" placeholder="APP SECRET"/>
          {err&&<div className="text-red-500 text-sm mb-3 text-center">{err}</div>}
          <label className="flex items-center gap-2 text-sm text-gray-600 mb-4">
            <input type="checkbox" checked={save} onChange={e=>setSave(e.target.checked)} className="w-4 h-4 rounded"/>
            ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
          </label>
          <button onClick={login} disabled={load} className="w-full bg-blue-500 text-white py-3 rounded-xl font-semibold text-base disabled:opacity-50">
            {load?'ì—°ê²° ì¤‘...':'ë¡œê·¸ì¸'}
          </button>
        </div>
      </div>
    </div>
  );

  // ë©”ì¸ í™”ë©´
  return(
    <div className="min-h-screen bg-gray-50 pb-20">
      {/* í—¤ë” */}
      <div className="bg-white px-4 py-3 border-b border-gray-100 sticky top-0 z-10">
        <div className="flex justify-between items-center max-w-lg mx-auto">
          <div>
            <h1 className="font-bold text-lg text-gray-900">ğŸ“ˆ ìŠ¤í¬ë¦¬ë„ˆ</h1>
            {upd&&<div className="text-xs text-gray-400">ì—…ë°ì´íŠ¸ {upd}</div>}
          </div>
          <button onClick={scan} disabled={load} className="bg-blue-500 text-white px-4 py-2 rounded-xl font-medium disabled:opacity-50">
            {load?'ë¶„ì„ì¤‘...':'ğŸ” ë¶„ì„'}
          </button>
        </div>
      </div>

      <div className="max-w-lg mx-auto p-4">
        {/* íƒ­ */}
        <div className="flex gap-2 mb-4 overflow-x-auto">
          {[{id:'home',l:'ğŸ  í™ˆ'},{id:'scan',l:'ğŸ“Š ìŠ¤í¬ë¦¬ë‹'},{id:'fav',l:`â­ ê´€ì‹¬(${favs.length})`},{id:'set',l:'âš™ï¸ ì„¤ì •'}].map(t=>(
            <button key={t.id} onClick={()=>setTab(t.id)} className={`px-4 py-2 rounded-xl font-medium whitespace-nowrap ${tab===t.id?'bg-blue-500 text-white':'bg-white text-gray-600'}`}>{t.l}</button>
          ))}
        </div>

        {/* í™ˆ íƒ­ */}
        {tab==='home'&&(
          <>
            <BriefingCard/>
            <NewsCard/>
            {list.length>0&&(
              <div>
                <div className="font-semibold text-gray-900 mb-3">ğŸ† AI ì¶”ì²œ TOP 5</div>
                {list.sort((a,b)=>(b.ai?.sc||0)-(a.ai?.sc||0)).slice(0,5).map((s,i)=><Card key={s.code} s={s} i={i}/>)}
              </div>
            )}
            {!list.length&&!load&&(
              <div className="text-center py-12">
                <div className="text-4xl mb-3">ğŸ‘†</div>
                <div className="text-gray-500">ìƒë‹¨ì˜ ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div>
              </div>
            )}
          </>
        )}

        {/* ìŠ¤í¬ë¦¬ë‹ íƒ­ */}
        {tab==='scan'&&(
          <>
            <div className="flex gap-2 mb-3">
              {[['day','ğŸ”¥ ë°ì´'],['swing','ğŸ“Š ìŠ¤ìœ™'],['bottom','ğŸ“‰ ì €ì ']].map(([m,l])=>(
                <button key={m} onClick={()=>setMode(m)} className={`flex-1 py-2 rounded-xl font-medium ${mode===m?'bg-blue-500 text-white':'bg-white text-gray-600'}`}>{l}</button>
              ))}
            </div>
            <div className="flex gap-2 mb-4">
              {[['all','ì „ì²´'],['low','ë™ì „ì£¼'],['mid','ì¤‘ê°€ì£¼']].map(([p,l])=>(
                <button key={p} onClick={()=>setPrice(p)} className={`flex-1 py-2 rounded-xl font-medium ${price===p?'bg-green-500 text-white':'bg-white text-gray-600'}`}>{l}</button>
              ))}
            </div>
            {list.map((s,i)=><Card key={s.code} s={s} i={i}/>)}
            {!list.length&&!load&&(
              <div className="text-center py-12">
                <div className="text-4xl mb-3">ğŸ“Š</div>
                <div className="text-gray-500">ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</div>
              </div>
            )}
          </>
        )}

        {/* ê´€ì‹¬ì¢…ëª© íƒ­ */}
        {tab==='fav'&&(
          <>
            {favs.length?favs.map((f,i)=>{
              const s=list.find(x=>x.code===f.code);
              return s?<Card key={f.code} s={s} i={i}/>:(
                <div key={f.code} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3">
                  <div className="font-semibold text-gray-900">{f.name}</div>
                  <div className="text-sm text-gray-500">{f.code}</div>
                  <div className="text-sm text-gray-400 mt-2">ë¶„ì„ í›„ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
                </div>
              );
            }):(
              <div className="text-center py-12">
                <div className="text-4xl mb-3">â­</div>
                <div className="text-gray-500">ê´€ì‹¬ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>
              </div>
            )}
          </>
        )}

        {/* ì„¤ì • íƒ­ */}
        {tab==='set'&&(
          <div className="space-y-3">
            <div className="bg-white rounded-2xl p-4">
              <div className="font-semibold text-gray-900 mb-2">ğŸ“± ì•± ì •ë³´</div>
              <div className="text-sm text-gray-500">ì£¼ì‹ ìŠ¤í¬ë¦¬ë„ˆ Ultimate</div>
              <div className="text-sm text-gray-400">KIS API + AI ë¶„ì„</div>
            </div>
            <div className="bg-white rounded-2xl p-4">
              <div className="font-semibold text-gray-900 mb-2">ğŸ’¾ ë°ì´í„°</div>
              <div className="text-sm text-gray-500">ê´€ì‹¬ì¢…ëª© {favs.length}ê°œ</div>
            </div>
            <button onClick={()=>{localStorage.clear();setFavs([])}} className="w-full bg-red-50 text-red-600 py-3 rounded-xl font-medium">
              ë°ì´í„° ì´ˆê¸°í™”
            </button>
            <button onClick={logout} className="w-full bg-gray-100 text-gray-600 py-3 rounded-xl font-medium">
              ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
        )}

        {load&&(
          <div className="text-center py-8">
            <div className="text-3xl animate-bounce mb-2">ğŸ“Š</div>
            <div className="text-gray-500">{prog}</div>
          </div>
        )}

        {err&&<div className="bg-red-50 text-red-600 p-4 rounded-xl text-center">{err}</div>}
      </div>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
